//////////////////////////////////////////////////////////////////////////////
// Generated by TKLGEN - Version Mar  8 2013
// Copyright (C) 2013, Thiago Adams (thiago.adams@gmail.com)
// www.thradams.com
//
// Permission to copy, use, modify, sell and distribute this software
// is granted provided this copyright notice appears in all copies.
// This software is provided "as is" without express or implied
// warranty, and with no claim as to its suitability for any purpose.
//
//////////////////////////////////////////////////////////////////////////////
#pragma once

#include <cassert>
#include <string>
#include "tokenizer.h"
#include "Sample3DFA.h"

//Select the input stream type
#include "FileStream.h"
//#include "StringStream.h"
//#include "YourStream.h"


namespace Sample3
{
    enum ErrorCode
    {
        ErrorCodeUnexpectedEof,
        ErrorCodeUnexpectedToken
    
    };


    class ParserException : public std::exception
    {
    public:
        int m_Line;
        int m_Col;
        ErrorCode m_Error;
        ParserException(int line,
                        int col,
                        ErrorCode error)
            : m_Line(line)
            , m_Col(col)
            , m_Error(error)
    {
    }
    };


    class Context
    {
        public:
        //Select
        typedef FileStream   InputStream;
        //typedef StringStream InputStream;
        //typedef YourStream   InputStream;
        
        typedef Tokenizer<Sample3::DFA, InputStream> Scanner;
        
        private:
        Scanner& m_scanner;
        
        Sample3::Tokens m_CurrentToken;
        std::wstring m_lexeme;
        
    public:
        Context(Scanner& s) : m_scanner(s)
        {
            if (!m_scanner.NextToken(m_lexeme, m_CurrentToken))
            {
                throw ParserException(GetLine(), GetCol(), ErrorCodeUnexpectedEof);
            }
        }

        //returns the current token
        Sample3::Tokens Token() const
        {
             return m_CurrentToken;
        }
        
        //checks if Token() == tk and then move the current token
        void Match(Sample3::Tokens tk)
        {
             if (tk != m_CurrentToken)
             {
                throw ParserException(GetLine(), GetCol(), ErrorCodeUnexpectedToken);
             }
             if (!m_scanner.NextToken(m_lexeme, m_CurrentToken))
             {
             }
        }
        
        int GetLine() const
        {
            return m_scanner.m_InputStream.GetLine();
        }
        
        int GetCol() const
        {
            return m_scanner.m_InputStream.GetCol();
        }
    };
    


    void Parse_Main(Context&);
} //namespace

